<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subgeneratorr</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header with Theme Toggle -->
        <header>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                <svg class="theme-icon theme-icon-dark" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                </svg>
                <svg class="theme-icon theme-icon-light" width="20" height="20" viewBox="0 0 20 20" fill="currentColor" style="display: none;">
                    <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/>
                </svg>
            </button>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Action Bar (Sticky) - Enhanced with Title -->
            <div class="action-bar">
                <div class="sticky-title">
                    <h1>Subgeneratorr</h1>
                    <p class="subtitle">Subtitle + Transcript Generation via Deepgram Nova-3</p>
                </div>

                <button onclick="submitBatch()" id="submitBtn" class="btn-primary" disabled style="min-width: 160px; margin: 0 auto;">Transcribe</button>

                <!-- Unified Status Area -->
                <div class="unified-status" id="unifiedStatus">
                    <div class="status-text" id="statusText"></div>
                    <div class="status-progress" id="statusProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-label" id="progressLabel">0%</div>
                    </div>
                </div>
            </div>

            <!-- File Selection Section -->
            <section aria-label="File selection">
                <div class="card">
                    <!-- Language Selection - Top Priority -->
                    <div class="language-section">
                        <div class="form-group">
                            <label for="language" style="font-size: var(--font-h3);">Language</label>
                            <select id="language">
                                <option value="en">English</option>
                                <option value="en-US">English (US)</option>
                                <option value="en-AU">English (Australia)</option>
                                <option value="en-GB">English (UK)</option>
                                <option value="en-IN">English (India)</option>
                                <option value="en-NZ">English (New Zealand)</option>
                                <option value="en-CA">English (Canada)</option>
                                <option value="en-IE">English (Ireland)</option>
                                <option value="es">Spanish</option>
                                <option value="es-419">Spanish (Latin America)</option>
                                <option value="fr">French</option>
                                <option value="fr-CA">French (Canada)</option>
                                <option value="de">German</option>
                                <option value="hi">Hindi</option>
                                <option value="ru">Russian</option>
                                <option value="pt">Portuguese</option>
                                <option value="pt-BR">Portuguese (Brazil)</option>
                                <option value="pt-PT">Portuguese (Portugal)</option>
                                <option value="ja">Japanese</option>
                                <option value="it">Italian</option>
                                <option value="nl">Dutch</option>
                                <option value="sv">Swedish</option>
                                <option value="sv-SE">Swedish (Sweden)</option>
                                <option value="da">Danish</option>
                                <option value="da-DK">Danish (Denmark)</option>
                                <option value="tr">Turkish</option>
                                <option value="no">Norwegian</option>
                                <option value="id">Indonesian</option>
                            </select>
                        </div>
                        <label class="checkbox-label" style="margin-top: var(--space-m); justify-content: center; color: var(--text-tertiary);">
                            <input type="checkbox" id="enableTranscript" onchange="toggleTranscriptOptions()" style="opacity: 0.6;">
                            <span>Generate Transcript</span>
                        </label>
                        <label class="checkbox-label" style="margin-top: var(--space-xs); justify-content: center; color: var(--text-tertiary);">
                            <input type="checkbox" id="forceRegenerate" style="opacity: 0.6;">
                            <span>Overwrite Existing Subtitles</span>
                        </label>
                    </div>

                    <!-- Directory Browser -->
                    <div id="directoryBrowser">
                        <div id="directoryList" class="files-list">
                            <div id="skeleton" class="skeleton-loader hidden">
                                <div class="skeleton-item"></div>
                                <div class="skeleton-item"></div>
                                <div class="skeleton-item"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Selection Actions -->
                    <div class="browser-toolbar" style="border-bottom: none; padding-top: var(--space-m);">
                        <div class="toolbar-right" style="margin: 0 auto;">
                            <button class="btn-link" onclick="selectAllInFolder()" id="selectAllBtn">Select All</button>
                            <span class="separator">•</span>
                            <button class="btn-link" onclick="selectNone()">Clear Selection</button>
                        </div>
                    </div>

                    <!-- Configuration Options -->
                    <div class="config-section" style="margin-top: var(--space-l); text-align: center;">
                        <div class="form-group">
                            <label for="keyTerms" style="font-size: var(--font-h3); color: var(--text-primary); text-align: center;">Keyterms</label>
                            <textarea id="keyTerms" rows="7" placeholder="e.g., Deepgram, iPhone, customer service" aria-label="Keyterms prompting" style="text-align: center;"></textarea>
                            <small style="color: var(--text-tertiary); display: block; margin-top: var(--space-xs); text-align: center; font-size: var(--font-caption);">
                                Keyterms are auto-loaded and auto-saved from CSV if available.
                            </small>
                            <div style="text-align: center; margin-top: var(--space-m);">
                                <button id="generateKeytermsBtn" class="btn-secondary" style="display: inline-flex;" title="Generate keyterms using AI">
                                    Generate Keyterms
                                </button>
                            </div>
                        </div>

                        <!-- Advanced Options Toggle -->
                        <div style="margin-top: var(--space-m); text-align: center;">
                            <button class="btn-link" onclick="toggleAdvancedOptions()" id="advancedToggle" style="font-size: var(--font-h3); color: var(--text-primary);">
                                Advanced Options ▼
                            </button>
                        </div>
                    </div>

                    <!-- Advanced Options (Collapsible) -->
                    <div id="advancedOptions" class="config-section hidden" style="padding-top: var(--space-l); text-align: center;">

                        <!-- Nova-3 Quality Enhancements -->
                        <div class="nova-settings" style="text-align: center;">
                            <h3 class="section-title" style="text-align: center;">Quality Enhancements</h3>

                            <div class="form-group" style="text-align: center;">
                                <label style="text-align: center; font-size: var(--font-body); color: var(--text-tertiary);">Profanity Filter</label>
                                <div class="radio-group" style="justify-content: center; margin: 0 auto;">
                                    <label class="radio-label" style="font-size: var(--font-small); color: var(--text-tertiary);">
                                        <input type="radio" name="profanityFilter" value="off" checked style="opacity: 0.6;">
                                        <span>Off</span>
                                    </label>
                                    <label class="radio-label" style="font-size: var(--font-small); color: var(--text-tertiary);">
                                        <input type="radio" name="profanityFilter" value="tag" style="opacity: 0.6;">
                                        <span>Tag</span>
                                    </label>
                                    <label class="radio-label" style="font-size: var(--font-small); color: var(--text-tertiary);">
                                        <input type="radio" name="profanityFilter" value="remove" style="opacity: 0.6;">
                                        <span>Remove</span>
                                    </label>
                                </div>
                            </div>

                            <div class="checkbox-group" style="margin-top: var(--space-l); display: flex; flex-direction: column; align-items: center;">
                                <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                    <input type="checkbox" id="numerals" checked style="opacity: 0.6;">
                                    <span>Convert numbers to digits</span>
                                </label>
                                <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                    <input type="checkbox" id="measurements" checked style="opacity: 0.6;">
                                    <span>Convert measurements to symbols</span>
                                </label>
                                <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                    <input type="checkbox" id="fillerWords" style="opacity: 0.6;">
                                    <span>Remove filler words</span>
                                </label>
                            </div>

                        </div>

                        <!-- Transcript Options -->
                        <div class="transcript-settings" style="text-align: center;">
                            <h3 class="section-title" style="text-align: center;">Transcript Options</h3>
                            <div class="checkbox-group" style="display: flex; flex-direction: column; align-items: center;">
                                <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                    <input type="checkbox" id="saveRawJson" style="opacity: 0.6;">
                                    <span>Save Raw JSON</span>
                                </label>
                                <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                    <input type="checkbox" id="diarization" checked style="opacity: 0.6;">
                                    <span>Speaker diarization</span>
                                </label>
                                <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                    <input type="checkbox" id="utterances" checked style="opacity: 0.6;">
                                    <span>Utterance segmentation</span>
                                </label>
                                <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                    <input type="checkbox" id="paragraphs" checked style="opacity: 0.6;">
                                    <span>Paragraph formatting</span>
                                </label>
                            </div>
                        </div>

                        <div id="transcriptOptions" style="display: none; margin-top: var(--space-m);">
                            <div class="status info">
                                <span style="color: var(--color-blue); font-size: var(--font-caption);">
                                    ℹ️ Speaker maps auto-detected from Transcripts/Speakermap/speakers.csv
                                </span>
                            </div>
                        </div>

                        <!-- LLM Keyterm Generation -->
                        <div class="llm-settings" style="margin-top: var(--space-l); text-align: center;">
                            <div style="display: flex; justify-content: center; align-items: center; margin-bottom: var(--space-m); flex-direction: column; gap: var(--space-xs);">
                                <h3 class="section-title" style="margin: 0; text-align: center;">AI Keyterm Generation</h3>
                                <span id="keytermCostEstimate" style="color: var(--text-tertiary); font-size: var(--font-small);"></span>
                            </div>

                            <div class="form-group" style="text-align: center;">
                                <label for="llmProvider" style="text-align: center; color: var(--text-tertiary);">
                                    API Key Status:
                                    <span id="apiKeyStatus" class="api-key-status" title="API key status"></span>
                                </label>
                                <select id="llmProvider" style="text-align: center; max-width: 300px; margin: 0 auto;">
                                    <option value="anthropic">Anthropic (Claude)</option>
                                    <option value="openai">OpenAI (GPT)</option>
                                </select>
                            </div>

                            <div class="form-group" style="text-align: center;">
                                <label for="llmModel" style="text-align: center; color: var(--text-tertiary);">Model</label>
                                <select id="llmModel" style="text-align: center; max-width: 300px; margin: 0 auto;">
                                    <option value="claude-sonnet-4-5">Claude Sonnet 4.5 (Best Quality)</option>
                                    <option value="claude-haiku-4-5">Claude Haiku 4.5 (Faster, Cheaper)</option>
                                </select>
                            </div>

                            <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                <input type="checkbox" id="preserveExisting" style="opacity: 0.6;">
                                <span>Merge with existing keyterms (instead of replacing)</span>
                            </label>
                        </div>

                        <!-- Language Options -->
                        <div class="nova-settings" style="text-align: center;">
                            <h3 class="section-title" style="text-align: center;">Language Options</h3>

                            <div class="checkbox-group" style="display: flex; flex-direction: column; align-items: center;">
                                <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                    <input type="checkbox" id="detectLanguage" style="opacity: 0.6;">
                                    <span>Auto-detect language</span>
                                </label>
                                <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                    <input type="checkbox" id="multiLanguage" onchange="handleMultiLanguageToggle()" style="opacity: 0.6;">
                                    <span>Multi-language code-switching</span>
                                </label>
                            </div>
                            <p class="help-text" style="margin-top: var(--space-s); text-align: center;">
                                <strong>Auto-detect:</strong> Single-language content with unknown language.<br>
                                <strong>Multi-language:</strong> Bilingual conversations with language switching.
                            </p>
                        </div>

                        <!-- Browser Preferences -->
                        <div class="browser-preferences-settings" style="margin-top: var(--space-l); text-align: center;">
                            <h3 class="section-title" style="text-align: center;">Browser Preferences</h3>
                            <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary);">
                                <input type="checkbox" id="onlyFoldersWithVideos" checked onchange="toggleFolderFilter()" style="opacity: 0.6;">
                                <span>Show folders with media only</span>
                            </label>
                            <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary); margin-top: var(--space-m);">
                                <input type="checkbox" id="autoClearFiles" checked style="opacity: 0.6;">
                                <span>Auto-clear files after completion</span>
                            </label>
                            <label class="checkbox-label" style="justify-content: center; color: var(--text-tertiary); margin-top: var(--space-m);">
                                <input type="checkbox" id="rememberSettings" onchange="toggleRememberSettings()" style="opacity: 0.6;">
                                <span>Remember my last settings (instead of defaults)</span>
                            </label>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Screen Reader Announcer -->
    <div aria-live="polite" aria-atomic="true" class="sr-only" id="status-announcer"></div>

    <script src="/static/app.js"></script>
</body>
</html>